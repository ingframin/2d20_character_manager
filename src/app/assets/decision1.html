<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title> Step 1 - MC3 Character Generator</title>
        <link rel="stylesheet" href="./assets/style.css">
    </head>
    <body>
        
        <h1>Decision 1: Starting characteristics</h1>
        <div id="error"></div>
        <form id="attribs" name="attribs">
            <div class="grid-container">
                <div class="grid-item">
                    <label for="agility">Agility:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="agility" name="agility" value="5"  onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="awareness">Awareness:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="awareness" name="awareness" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="coordination">Coordination:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="coordination" name="coordination" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="intelligence">Intelligence:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="intelligence" name="intelligence" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="mental">Mental:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="mental" name="mental" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="personality">Personality:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in" type="number" id="personality" name="personality" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="physique">Physique:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in"  type="number" id="physique" name="physique" value="5" onchange="validateVal(this)"></br>
                </div>
                <div class="grid-item">
                    <label for="strength">Strength:</label>
                </div>
                <div class="grid-item">
                    <input class="form-in" type="number" id="strength" name="strength" value="5" onchange="validateVal(this)"></br>
                </div>
            </div>
            <input type="button" value="OK" onclick="checkAndSubmit()">
        </form>
        
    </body>
    <script>
        function validateVal(elem){
            let x = parseInt(elem.value);
            if(x > 6){
                elem.value = 6;
            }
            else if(x<4){
                elem.value = 4;
            }
        }

        function checkAndSubmit(){
            let formContent = document.getElementById("attribs");
            let formData = new FormData(formContent);
            var sum = 0;

            formData.forEach(function(value, key){
                
                sum += parseInt(value);
                }
                );
            console.log(sum);
            if(sum < 40 || sum > 45){
                var element = document.getElementById("error");
                element.style.backgroundColor = 'yellow';
                element.style.textAlign = "center";
                element.style.color = "red"
                element.style.fontSize = "20px"
                element.innerHTML = 'Error: the sum of all attributes must be between 40 and 45!'
                return
            }

            const xhttp = new XMLHttpRequest();
            xhttp.onload = function() {
                document.getElementById("error").innerHTML = this.responseText;
                }
            xhttp.open("POST", "update_session", true);
            xhttp.send(formData);
            window.open("decision2","_self")
            
        }
    </script>

</html>